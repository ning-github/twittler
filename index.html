<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" type="text/css" href="stylesheet.css">
    <script src="jquery.js"></script>
    <!-- timeago library for human friendly fuzzy times -->
    <script src = "http://timeago.yarp.com/jquery.timeago.js"></script>
    <script src="data_generator.js"></script>
  </head>
  <body>

    <section class = "feed"></section>

    <ul>Users</ul>    




    <script>

      $(document).ready(function(){
        var $feed = $('.feed');

        var refreshFeed = function(input){   

          $feed.html('');

          var index = input.length - 1;

          while(index >= 0){
            var tweet = input[index];
            var $tweet = $('<div></div>');

            //timestamp, using timeago to convert created_at property
            var timestamp = $.timeago(tweet.created_at);  
            var $timestamp = $("<div></div>");

            $tweet.text('@' + tweet.user + ': ' + tweet.message);
            $timestamp.text(timestamp);

            $timestamp.appendTo($tweet);
            $tweet.appendTo($feed);

            index -= 1;
          }
        }

        refreshFeed(streams.home);


        //mainfeed auto refresh
        var autoFeed = setInterval(function(){
          refreshFeed(streams.home);
        },1500);

        //initial list of users
        var $ul = $("ul");
        for (var user in streams.users){
          var $eachUser = $("<li></li>");
          $eachUser.text(user);
          $eachUser.appendTo($ul);
        }

        //swtiches feed to that user when a user is clicked
        $("li").on("click",function(){
          clearTimeout(autoFeed); //stops mainFeed autorefresh
          var name = $(this).text();

          refreshFeed(streams.users[name]);
          autoFeed = setInterval(function(){
          refreshFeed(streams.users[name]);
        },1500);

        })


      });

    </script>


  </body>
</html>
