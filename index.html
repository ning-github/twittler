<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" type="text/css" href="stylesheet.css">
    <link rel="stylesheet" type="text/css" href="bootstrap.min.css">
    <script src="jquery.js"></script>
    <!-- timeago library for human friendly fuzzy times -->
    <script src = "http://timeago.yarp.com/jquery.timeago.js"></script>
    <script src="data_generator.js"></script>
    <script src= "bootstrap.min.js"></script>
  </head>
  <body>

    
    <div class = "container">
      <h1>Twittler</h1>
      
      <section class = "twittle">
        my name is @<input type = "text" id="name">
        and my message is <input type = "text" id="message">
      </section>


      <section class = "col-md-3 users"> Users
        <ul></ul>    
      </section>

      


      <section class = "feed col-md-9"></section>
    <div>




    <script>

      $(document).ready(function(){
        var $feed = $('.feed');
    
        var currentMainFeed = []; //to track what is old vs new. 
        //  ^--this helps with later checking of whether to call refreshFeed


        var refreshFeed = function(input, currentFeed){   

          $feed.html('');

          var index = input.length - 1;

          while(index >= 0){
            var tweet = input[index];
            var $tweet = $('<div></div>');

            //timestamp, using timeago to convert created_at property
            var timestamp = $.timeago(tweet.created_at);  
            var $timestamp = $("<div></div>");

            $tweet.text('@' + tweet.user + ': ' + tweet.message);
            $timestamp.text(timestamp);

            $timestamp.appendTo($tweet);
            $tweet.appendTo($feed);

            index -= 1;
            currentFeed.push(tweet);  // tweet is stored as old
          }
        }

        refreshFeed(streams.home, currentMainFeed);


        //mainfeed auto refresh

        var autoFeed = setInterval(function(){
          if ((streams.home).length > currentMainFeed.length){  //this check will help us not call refreshFeed unless needed
            currentMainFeed = []; //this clear is required, as refreshFeed will push the WHOLE contents (new and old)
            refreshFeed(streams.home, currentMainFeed);
          }
        },1500);


        //initial list of users
        var $ul = $("ul");
        for (var user in streams.users){
          var $eachUser = $("<li></li>");
          $eachUser.text(user);
          $eachUser.appendTo($ul);
        }

        //switches feed to that user when a user is clicked
        $("li").on("click",function(){
          clearInterval(autoFeed); //stops mainFeed autorefresh
          var name = $(this).text();

          var currentUserFeed=[]; // like the main version, but for each user click

          refreshFeed(streams.users[name], currentUserFeed); //run immediately, since the below code must wait the delay time to run for the first time
          autoFeed = setInterval(function(){
            if ((streams.users[name]).length > currentUserFeed.length){
              currentUserFeed = []; 
              refreshFeed(streams.users[name], currentUserFeed);
            }
          },1500);

        });

        $("h1").on("click", function(){

        });




      });

    </script>


  </body>
</html>
